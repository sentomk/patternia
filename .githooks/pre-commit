#!/usr/bin/env bash
set -euo pipefail

if ! command -v clang-format >/dev/null 2>&1; then
  echo "pre-commit: clang-format not found in PATH."
  echo "Install clang-format or bypass with --no-verify."
  exit 1
fi

mapfile -t files < <(
  git diff --cached --name-only --diff-filter=ACMR -- \
    '*.h' '*.hpp' '*.hh' '*.hxx' '*.c' '*.cc' '*.cpp' '*.cxx' '*.ipp'
)

if [ "${#files[@]}" -eq 0 ]; then
  exit 0
fi

for file in "${files[@]}"; do
  if [ -f "$file" ]; then
    clang-format -i -style=file "$file"
    git add "$file"
  fi
done
